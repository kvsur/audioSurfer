!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}(window,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=7)}([function(e,t,r){"use strict";var n=Object.prototype.hasOwnProperty,o=Array.isArray,i=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),a=function(e,t){for(var r=t&&t.plainObjects?Object.create(null):{},n=0;n<e.length;++n)void 0!==e[n]&&(r[n]=e[n]);return r};e.exports={arrayToObject:a,assign:function(e,t){return Object.keys(t).reduce(function(e,r){return e[r]=t[r],e},e)},combine:function(e,t){return[].concat(e,t)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],r=[],n=0;n<t.length;++n)for(var i=t[n],a=i.obj[i.prop],s=Object.keys(a),c=0;c<s.length;++c){var u=s[c],f=a[u];"object"==typeof f&&null!==f&&-1===r.indexOf(f)&&(t.push({obj:a,prop:u}),r.push(f))}return function(e){for(;e.length>1;){var t=e.pop(),r=t.obj[t.prop];if(o(r)){for(var n=[],i=0;i<r.length;++i)void 0!==r[i]&&n.push(r[i]);t.obj[t.prop]=n}}}(t),e},decode:function(e,t,r){var n=e.replace(/\+/g," ");if("iso-8859-1"===r)return n.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(n)}catch(e){return n}},encode:function(e,t,r){if(0===e.length)return e;var n="string"==typeof e?e:String(e);if("iso-8859-1"===r)return escape(n).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});for(var o="",a=0;a<n.length;++a){var s=n.charCodeAt(a);45===s||46===s||95===s||126===s||s>=48&&s<=57||s>=65&&s<=90||s>=97&&s<=122?o+=n.charAt(a):s<128?o+=i[s]:s<2048?o+=i[192|s>>6]+i[128|63&s]:s<55296||s>=57344?o+=i[224|s>>12]+i[128|s>>6&63]+i[128|63&s]:(a+=1,s=65536+((1023&s)<<10|1023&n.charCodeAt(a)),o+=i[240|s>>18]+i[128|s>>12&63]+i[128|s>>6&63]+i[128|63&s])}return o},isBuffer:function(e){return!(!e||"object"!=typeof e||!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e)))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},merge:function e(t,r,i){if(!r)return t;if("object"!=typeof r){if(o(t))t.push(r);else{if(!t||"object"!=typeof t)return[t,r];(i&&(i.plainObjects||i.allowPrototypes)||!n.call(Object.prototype,r))&&(t[r]=!0)}return t}if(!t||"object"!=typeof t)return[t].concat(r);var s=t;return o(t)&&!o(r)&&(s=a(t,i)),o(t)&&o(r)?(r.forEach(function(r,o){if(n.call(t,o)){var a=t[o];a&&"object"==typeof a&&r&&"object"==typeof r?t[o]=e(a,r,i):t.push(r)}else t[o]=r}),t):Object.keys(r).reduce(function(t,o){var a=r[o];return n.call(t,o)?t[o]=e(t[o],a,i):t[o]=a,t},s)}}},function(e,t,r){"use strict";var n=String.prototype.replace,o=/%20/g;e.exports={default:"RFC3986",formatters:{RFC1738:function(e){return n.call(e,o,"+")},RFC3986:function(e){return e}},RFC1738:"RFC1738",RFC3986:"RFC3986"}},function(e,t,r){"use strict";var n=r(5),o=r(6),i=r(1);e.exports={formats:i,parse:o,stringify:n}},function(e,t,r){(function(n){var o,i;void 0===(i="function"==typeof(o=function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function s(e,t,r){return(s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=o(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}var c=function(){function t(){e(this,t),Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}return r(t,[{key:"addEventListener",value:function(e,t){e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push(t)}},{key:"removeEventListener",value:function(e,t){if(e in this.listeners)for(var r=this.listeners[e],n=0,o=r.length;n<o;n++)if(r[n]===t)return void r.splice(n,1)}},{key:"dispatchEvent",value:function(e){var t=this;if(e.type in this.listeners){for(var r=function(r){setTimeout(function(){return r.call(t,e)})},n=this.listeners[e.type],o=0,i=n.length;o<i;o++)r(n[o]);return!e.defaultPrevented}}}]),t}(),u=function(t){function n(){var t,r,i;return e(this,n),(r=this,i=o(n).call(this),t=!i||"object"!=typeof i&&"function"!=typeof i?a(r):i).listeners||c.call(a(t)),Object.defineProperty(a(t),"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(a(t),"onabort",{value:null,writable:!0,configurable:!0}),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(n,t),r(n,[{key:"toString",value:function(){return"[object AbortSignal]"}},{key:"dispatchEvent",value:function(e){"abort"===e.type&&(this.aborted=!0,"function"==typeof this.onabort&&this.onabort.call(this,e)),s(o(n.prototype),"dispatchEvent",this).call(this,e)}}]),n}(c),f=function(){function t(){e(this,t),Object.defineProperty(this,"signal",{value:new u,writable:!0,configurable:!0})}return r(t,[{key:"abort",value:function(){var e;try{e=new Event("abort")}catch(t){"undefined"!=typeof document?document.createEvent?(e=document.createEvent("Event")).initEvent("abort",!1,!1):(e=document.createEventObject()).type="abort":e={type:"abort",bubbles:!1,cancelable:!1}}this.signal.dispatchEvent(e)}},{key:"toString",value:function(){return"[object AbortController]"}}]),t}();function l(e){return e.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL?(console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill"),!0):"function"==typeof e.Request&&!e.Request.prototype.hasOwnProperty("signal")||!e.AbortController}"undefined"!=typeof Symbol&&Symbol.toStringTag&&(f.prototype[Symbol.toStringTag]="AbortController",u.prototype[Symbol.toStringTag]="AbortSignal"),function(e){if(l(e))if(e.fetch){var t=function(e){"function"==typeof e&&(e={fetch:e});var t=e,r=t.fetch,n=t.Request,o=void 0===n?r.Request:n,i=t.AbortController,a=t.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL,s=void 0!==a&&a;if(!l({fetch:r,Request:o,AbortController:i,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:s}))return{fetch:r,Request:c};var c=o;(c&&!c.prototype.hasOwnProperty("signal")||s)&&((c=function(e,t){var r;t&&t.signal&&(r=t.signal,delete t.signal);var n=new o(e,t);return r&&Object.defineProperty(n,"signal",{writable:!1,enumerable:!1,configurable:!0,value:r}),n}).prototype=o.prototype);var u=r;return{fetch:function(e,t){var r=c&&c.prototype.isPrototypeOf(e)?e.signal:t?t.signal:void 0;if(r){var n;try{n=new DOMException("Aborted","AbortError")}catch(e){(n=new Error("Aborted")).name="AbortError"}if(r.aborted)return Promise.reject(n);var o=new Promise(function(e,t){r.addEventListener("abort",function(){return t(n)},{once:!0})});return t&&t.signal&&delete t.signal,Promise.race([o,u(e,t)])}return u(e,t)},Request:c}}(e),r=t.fetch,n=t.Request;e.fetch=r,e.Request=n,Object.defineProperty(e,"AbortController",{writable:!0,enumerable:!1,configurable:!0,value:f}),Object.defineProperty(e,"AbortSignal",{writable:!0,enumerable:!1,configurable:!0,value:u})}else console.warn("fetch() is not available, cannot install abortcontroller-polyfill")}("undefined"!=typeof self?self:n)})?o.call(t,r,t,e):o)||(e.exports=i)}).call(this,r(4))},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";var n=r(0),o=r(1),i=Object.prototype.hasOwnProperty,a={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},s=Array.isArray,c=Array.prototype.push,u=function(e,t){c.apply(e,s(t)?t:[t])},f=Date.prototype.toISOString,l={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:n.encode,encodeValuesOnly:!1,formatter:o.formatters[o.default],indices:!1,serializeDate:function(e){return f.call(e)},skipNulls:!1,strictNullHandling:!1},h=function e(t,r,o,i,a,c,f,h,d,p,y,g,v){var b=t;if("function"==typeof f?b=f(r,b):b instanceof Date?b=p(b):"comma"===o&&s(b)&&(b=b.join(",")),null===b){if(i)return c&&!g?c(r,l.encoder,v):r;b=""}if("string"==typeof b||"number"==typeof b||"boolean"==typeof b||n.isBuffer(b))return c?[y(g?r:c(r,l.encoder,v))+"="+y(c(b,l.encoder,v))]:[y(r)+"="+y(String(b))];var _,m=[];if(void 0===b)return m;if(s(f))_=f;else{var w=Object.keys(b);_=h?w.sort(h):w}for(var O=0;O<_.length;++O){var L=_[O];a&&null===b[L]||(s(b)?u(m,e(b[L],"function"==typeof o?o(r,L):r,o,i,a,c,f,h,d,p,y,g,v)):u(m,e(b[L],r+(d?"."+L:"["+L+"]"),o,i,a,c,f,h,d,p,y,g,v)))}return m};e.exports=function(e,t){var r,n=e,c=function(e){if(!e)return l;if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");var t=e.charset||l.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=o.default;if(void 0!==e.format){if(!i.call(o.formatters,e.format))throw new TypeError("Unknown format option provided.");r=e.format}var n=o.formatters[r],a=l.filter;return("function"==typeof e.filter||s(e.filter))&&(a=e.filter),{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:l.addQueryPrefix,allowDots:void 0===e.allowDots?l.allowDots:!!e.allowDots,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:l.charsetSentinel,delimiter:void 0===e.delimiter?l.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:l.encode,encoder:"function"==typeof e.encoder?e.encoder:l.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:l.encodeValuesOnly,filter:a,formatter:n,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:l.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:l.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:l.strictNullHandling}}(t);"function"==typeof c.filter?n=(0,c.filter)("",n):s(c.filter)&&(r=c.filter);var f,d=[];if("object"!=typeof n||null===n)return"";f=t&&t.arrayFormat in a?t.arrayFormat:t&&"indices"in t?t.indices?"indices":"repeat":"indices";var p=a[f];r||(r=Object.keys(n)),c.sort&&r.sort(c.sort);for(var y=0;y<r.length;++y){var g=r[y];c.skipNulls&&null===n[g]||u(d,h(n[g],g,p,c.strictNullHandling,c.skipNulls,c.encode?c.encoder:null,c.filter,c.sort,c.allowDots,c.serializeDate,c.formatter,c.encodeValuesOnly,c.charset))}var v=d.join(c.delimiter),b=!0===c.addQueryPrefix?"?":"";return c.charsetSentinel&&("iso-8859-1"===c.charset?b+="utf8=%26%2310003%3B&":b+="utf8=%E2%9C%93&"),v.length>0?b+v:""}},function(e,t,r){"use strict";var n=r(0),o=Object.prototype.hasOwnProperty,i={allowDots:!1,allowPrototypes:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:n.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},a=function(e){return e.replace(/&#(\d+);/g,function(e,t){return String.fromCharCode(parseInt(t,10))})},s=function(e,t,r){if(e){var n=r.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,i=/(\[[^[\]]*])/g,a=/(\[[^[\]]*])/.exec(n),s=a?n.slice(0,a.index):n,c=[];if(s){if(!r.plainObjects&&o.call(Object.prototype,s)&&!r.allowPrototypes)return;c.push(s)}for(var u=0;null!==(a=i.exec(n))&&u<r.depth;){if(u+=1,!r.plainObjects&&o.call(Object.prototype,a[1].slice(1,-1))&&!r.allowPrototypes)return;c.push(a[1])}return a&&c.push("["+n.slice(a.index)+"]"),function(e,t,r){for(var n=t,o=e.length-1;o>=0;--o){var i,a=e[o];if("[]"===a&&r.parseArrays)i=[].concat(n);else{i=r.plainObjects?Object.create(null):{};var s="["===a.charAt(0)&&"]"===a.charAt(a.length-1)?a.slice(1,-1):a,c=parseInt(s,10);r.parseArrays||""!==s?!isNaN(c)&&a!==s&&String(c)===s&&c>=0&&r.parseArrays&&c<=r.arrayLimit?(i=[])[c]=n:i[s]=n:i={0:n}}n=i}return n}(c,t,r)}};e.exports=function(e,t){var r=function(e){if(!e)return i;if(null!==e.decoder&&void 0!==e.decoder&&"function"!=typeof e.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new Error("The charset option must be either utf-8, iso-8859-1, or undefined");var t=void 0===e.charset?i.charset:e.charset;return{allowDots:void 0===e.allowDots?i.allowDots:!!e.allowDots,allowPrototypes:"boolean"==typeof e.allowPrototypes?e.allowPrototypes:i.allowPrototypes,arrayLimit:"number"==typeof e.arrayLimit?e.arrayLimit:i.arrayLimit,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:i.charsetSentinel,comma:"boolean"==typeof e.comma?e.comma:i.comma,decoder:"function"==typeof e.decoder?e.decoder:i.decoder,delimiter:"string"==typeof e.delimiter||n.isRegExp(e.delimiter)?e.delimiter:i.delimiter,depth:"number"==typeof e.depth?e.depth:i.depth,ignoreQueryPrefix:!0===e.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof e.interpretNumericEntities?e.interpretNumericEntities:i.interpretNumericEntities,parameterLimit:"number"==typeof e.parameterLimit?e.parameterLimit:i.parameterLimit,parseArrays:!1!==e.parseArrays,plainObjects:"boolean"==typeof e.plainObjects?e.plainObjects:i.plainObjects,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:i.strictNullHandling}}(t);if(""===e||null==e)return r.plainObjects?Object.create(null):{};for(var c="string"==typeof e?function(e,t){var r,s={},c=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,u=t.parameterLimit===1/0?void 0:t.parameterLimit,f=c.split(t.delimiter,u),l=-1,h=t.charset;if(t.charsetSentinel)for(r=0;r<f.length;++r)0===f[r].indexOf("utf8=")&&("utf8=%E2%9C%93"===f[r]?h="utf-8":"utf8=%26%2310003%3B"===f[r]&&(h="iso-8859-1"),l=r,r=f.length);for(r=0;r<f.length;++r)if(r!==l){var d,p,y=f[r],g=y.indexOf("]="),v=-1===g?y.indexOf("="):g+1;-1===v?(d=t.decoder(y,i.decoder,h),p=t.strictNullHandling?null:""):(d=t.decoder(y.slice(0,v),i.decoder,h),p=t.decoder(y.slice(v+1),i.decoder,h)),p&&t.interpretNumericEntities&&"iso-8859-1"===h&&(p=a(p)),p&&t.comma&&p.indexOf(",")>-1&&(p=p.split(",")),o.call(s,d)?s[d]=n.combine(s[d],p):s[d]=p}return s}(e,r):e,u=r.plainObjects?Object.create(null):{},f=Object.keys(c),l=0;l<f.length;++l){var h=f[l],d=s(h,c[h],r);u=n.merge(u,d,r)}return n.compact(u)}},function(e,t,r){"use strict";r.r(t);r(3);function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,o;return t=e,(r=[{key:"decode",value:function(e){this._dataBufferCache=[],this._dataBufferRangeList=[];var t=this._getWavInfo(e),r=t.sampleRate,n=t.numOfChannels,o=t.headBuffer,i=t.dataBuffer,a=t.totalDataByteLength,s=t.bitWide,c=t.byteSpeed,u=t.duration;this._perDataBufferPiceLength=1*r*n*s/8,this._byteSpeed=c,this._duration=u;var f=window.OfflineAudioContext||window.webkitOfflineAudioContext;if(!f)throw this.onerror("Not Suport Error"),new Error("Not Suport Error");this._audioContext=new f(n,this._perDataBufferPiceLength,44100),this._totalDataBufferLength=a,this._headerBuffer=o,this._decodedDataByteLength=0,this._lastCacheIndex=0,this._cachedDataByteLength=0,this._cacheOffset=0,this._cacheDataBufferList(i),this._decodeBufferPice(),this.decode=function(){}}},{key:"appendBuffer",value:function(e){var t=this._cachedDataByteLength>=this._totalDataBufferLength,r=!this._dataBufferRangeList.length;this._cacheDataBufferList(e),!t&&r&&this._decodeBufferPice()}},{key:"abort",value:function(){this._release(),this.onabort()}},{key:"_release",value:function(){this._dataBufferCache=null,this._dataBufferRangeList=null,this._perDataBufferPiceLength=null,this._byteSpeed=0,this._duration=0,this._audioContext=null,this._totalDataBufferLength=0,this._headerBuffer=null,this._decodedDataByteLength=0,this._lastCacheIndex=0,this._cachedDataByteLength=0,this._cacheOffset=0,this._decodeBufferPice=function(){},this.appendBuffer=function(){},this.onprocess=function(){},this.onwaitting=function(){}}},{key:"_cacheDataBufferList",value:function(e){this._dataBufferCache.push(e);var t=this._dataBufferCache.length-1,r=0;if(this._tempBufferRange){var n=this._totalDataBufferLength-this._cachedDataByteLength,o=this._perDataBufferPiceLength-this._tempBufferRange.length;o=o<=n?o:n,e.byteLength>=o?(this._tempBufferRange.segments.push({cacheIndex:t,offset:r,length:o,cacheOffset:this._cacheOffset}),this._tempBufferRange.length+=o,this._cachedDataByteLength+=o,r+=o,this._dataBufferRangeList.push(this._tempBufferRange),this._tempBufferRange=null):(this._tempBufferRange.segments.push({cacheIndex:t,offset:r,length:e.byteLength,cacheOffset:this._cacheOffset}),this._tempBufferRange.length+=e.byteLength,this._cachedDataByteLength+=e.byteLength,r+=e.byteLength)}for(var i=Math.floor((e.byteLength-r)/this._perDataBufferPiceLength),a=0;a<i;a++)this._dataBufferRangeList.push({segments:[{cacheIndex:t,offset:r,length:this._perDataBufferPiceLength,cacheOffset:this._cacheOffset}],length:this._perDataBufferPiceLength}),r+=this._perDataBufferPiceLength,this._cachedDataByteLength+=this._perDataBufferPiceLength;var s=e.byteLength-r;if(s)if(this._cachedDataByteLength+s>=this._totalDataBufferLength){var c=this._totalDataBufferLength-this._cachedDataByteLength;this._dataBufferRangeList.push({segments:[{cacheIndex:t,offset:r,length:c,cacheOffset:this._cacheOffset}],length:c}),this._cachedDataByteLength=this._totalDataBufferLength}else{var u=e.byteLength-r;this._tempBufferRange={segments:[{cacheIndex:t,offset:r,length:u,cacheOffset:this._cacheOffset}],length:u},this._cachedDataByteLength+=u}}},{key:"_decodeBufferPice",value:function(){var e=this,t=this._dataBufferRangeList.shift();if(t){var r=this._getRangeAuidoBuffer(t);this._audioContext.decodeAudioData(r,function(r){var n=e._decodedDataByteLength/e._byteSpeed;e._decodedDataByteLength+=t.length;var o=e._decodedDataByteLength>=e._totalDataBufferLength;o||e._decodeBufferPice(),e.onprocess({audioBuffer:r,startTime:n,endTime:e._decodedDataByteLength/e._byteSpeed,duration:e._duration}),o&&(e._dataBufferCache=null,e.oncomplete(),e._release())},this.onerror)}else this.onwaitting()}},{key:"_getRangeAuidoBuffer",value:function(e){var t=this,r=e.segments,n=e.length,o=new ArrayBuffer(this._headerBuffer.byteLength+n),i=new Uint8Array(o),a=0;this._setWavHeadDataLength(n);var s=new Uint8Array(this._headerBuffer);return i.set(s),a+=this._headerBuffer.byteLength,r.forEach(function(e){var r=e.cacheIndex,n=e.offset,o=e.length,s=e.cacheOffset;r-s!==t._lastCacheIndex&&(t._dataBufferCache.shift(),t._cacheOffset--,t._lastCacheIndex=r-s);var c=r+t._cacheOffset-s,u=t._dataBufferCache[c],f=new Uint8Array(u,n,o);i.set(f,a),a+=o}),o}},{key:"_setWavHeadDataLength",value:function(e){new DataView(this._headerBuffer).setUint32(this._dataLengthOffset,e,!0)}},{key:"_getWavInfo",value:function(e){var t=new DataView(e),r=this._getString(t,0,4),n=this._getString(t,8,4);if("RIFF"!==r||"WAVE"!==n)throw this.onerror(new Error("Format Error.")),new Error("Format Error");this._dataLengthOffset=this._getDataOffset(t);var o=t.getUint32(this._dataLengthOffset,!0),i=t.getUint16(22,!0),a=t.getUint16(34,!0),s=t.getUint32(24,!0),c=t.getUint32(28,!0);return{bitWide:a,sampleRate:s,numOfChannels:i,headBuffer:e.slice(0,this._dataLengthOffset+4),dataBuffer:e.slice(this._dataLengthOffset+4,this._dataLengthOffset+4+o),totalDataByteLength:o,byteSpeed:c,duration:o/c}}},{key:"_getDataOffset",value:function(e){for(var t=20+e.getUint32(16,!0);;){if("data"===this._getString(e,t,4))return 4+t;t+=e.getUint32(t+4,!0)+4+4}}},{key:"_getString",value:function(e,t,r){for(var n="",o=0;o<r;o++)n+=String.fromCharCode(e.getUint8(t+o));return n}},{key:"onprocess",value:function(e){}},{key:"onwaitting",value:function(){}},{key:"oncomplete",value:function(){}},{key:"onabort",value:function(){}},{key:"onerror",value:function(e){console.error(e)}}])&&n(t.prototype,r),o&&n(t,o),e}();function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var a=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var n=(r||{}).color;this._canvas=document.createElement("canvas"),this._context=this._canvas.getContext("2d"),this._canvas.width=devicePixelRatio*Math.max(window.screen.width,window.screen.height),this._canvas.style.width="100%",this._canvas.style.height="100%",this._canvas.height=t.clientHeight,this._halfHeight=.5*this._canvas.height,this._color=n,this.reset(),t.appendChild(this._canvas)}var t,r,n;return t=e,(r=[{key:"_setColor",value:function(){var e,t=this;this._color instanceof Array?(e=this._context.createLinearGradient(0,this._halfHeight,this._canvas.width,this._halfHeight),this._color.forEach(function(r,n){if("string"==typeof r)e.addColorStop(n/(t._color.length-1),r);else{var o=r.offset,i=r.value;e.addColorStop(o,i)}})):e=this._color,this._context.strokeStyle=e}},{key:"reset",value:function(){this._setColor(),this._context.beginPath(),this._context.strokeStyle=this._color,this._context.lineWidth=2,this._context.moveTo(0,this._halfHeight),this._context.lineTo(this._canvas.width,this._halfHeight),this._context.stroke()}},{key:"render",value:function(e,t,r){var n=e.getChannelData(0);this._isReset||(this._canvas.width=Math.min(30766,1*n.length/(r-t)),this._context=this._canvas.getContext("2d"),this.reset(),this._isReset=!0);var o=Math.floor(this._canvas.width*t),i=Math.ceil(this._canvas.width*r),a=Math.max(Math.floor(2*(i-o)),1),s=Math.max(Math.floor(n.length/a),1),c=(i-o)/a;this._context.beginPath(),this._context.strokeStyle=this._color;for(var u=0;u<a;u++){for(var f=[],l=0;l<s;l++)f.push(Math.abs(n[l+u]));var h=o+c*u,d=f.reduce(function(e,t){return e+t})/f.length;this._context.lineTo(h,this._halfHeight+this._halfHeight*+d*(u%2*2-1))}this._context.stroke()}},{key:"clear",value:function(){this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}}])&&i(t.prototype,r),n&&i(t,n),e}(),s=r(2);function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){u(e,t,r[t])})}return e}function u(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function f(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var l={Decorder:o,Render:a,DataTransformer:function(e,t,r){return e=e||"","GET"===(r=r||"GET")?(t=t instanceof FormData?null:Object(s.stringify)(t),e="".concat(e,"?").concat(t),t=null):t=t instanceof FormData?t:JSON.stringify(t),{url:e,fetchOptions:{body:t}}}},h=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._plugins=c({},l);var n=(r||{}).color;this._render=new this._plugins.Render(t,{color:n})}var t,r,n;return t=e,n=[{key:"use",value:function(e){var t=Object.keys(e||{}).filter(function(e){return!l[e]});if(t.length)throw new Error("[ ".concat(t.join(" , ")," ] is not support."));l=c({},l,e)}},{key:"plugins",value:function(){return c({},l)}}],(r=[{key:"load",value:function(e,t){var r=this;if(this._decoder&&this._decoder.abort(),this._decoder=new this._plugins.Decorder,this._render.clear(),this._render.reset(),this._decoder.onprocess=function(e){var t=e.audioBuffer,n=e.startTime,o=e.endTime,i=e.duration;r._render.render(t,n/i,o/i)},this._decoder.onerror=this.onerror,e instanceof ArrayBuffer)this._decoder.decode(e),this.append=function(e){r._decoder.appendBuffer(e)};else{var n=t||{},o=n.data,i=n.method;this._loadAudio(e,o,i)}}},{key:"append",value:function(e){}},{key:"abort",value:function(){this._decoder&&this._decoder.abort(),this.onabort()}},{key:"onerror",value:function(e){console.error(e)}},{key:"onabort",value:function(){}},{key:"_loadAudio",value:function(e,t,r){var n=this,o=new AbortController,i=o.signal,a=this._plugins.DataTransformer(e,t,r),s=a.url,u=c({signal:i,method:r},a.fetchOptions);window.fetch(s,u).then(function(e){var t=e.body.getReader();n._decoder.onwaitting=function(){return t.read().then(function(e){if(!e.done){var t=new ArrayBuffer(e.value.length);new Uint8Array(t).set(e.value),n._decoder.appendBuffer(t)}}).catch(function(e){console.error(e)})},n._decoder.onabort=function(){o.abort(),t.cancel().catch(function(e){console.warn("WaveVisual load canceld.")})},t.read().then(function(e){var t=new ArrayBuffer(e.value.length);new Uint8Array(t).set(e.value),n._decoder.decode(t)})}).catch(function(e){console.error(e)})}}])&&f(t.prototype,r),n&&f(t,n),e}();function d(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function p(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var y=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);this.options=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){d(e,t,r[t])})}return e}({},{pointerColor:"#ff6666",progressColor:"rgba(160, 160, 160, .5)",onWrapperProgress:function(){}},r),this.wrapper=t.querySelector("#audioSurferWrapper"),this.wrapper?this.innerWrapper=this.wrapper.querySelector("#audioSurferInnerWrapper"):this._createWrapper(t)}var t,r,n;return t=e,(r=[{key:"_createWrapper",value:function(e){var t=this,r=this.options,n=r.progressColor,o=r.pointerColor,i=document.createElement("div");i.addEventListener("click",function(e){t._dealInnerProgress(e)}),i.id="audioSurferWrapper",i.style.cssText="position: absolute;width: 100%;height: 100%;top: 0;background-color: transparent;cursor: pointer;";var a=document.createElement("div");a.id="audioSurferInnerWrapper",a.style.cssText="height: 100%;width: 0%;background-color: ".concat(n,";border-right: 1px solid ").concat(o,";transition: width .5s;"),i.appendChild(a),this.wrapper=i,this.innerWrapper=a,e.appendChild(this.wrapper)}},{key:"dealProgress",value:function(e){var t=e.percent;if(!this.innerWrapper)throw new Error("Wrapper do not created");this.innerWrapper.style.width="".concat(t)}},{key:"_dealInnerProgress",value:function(e){var t=this.wrapper.getBoundingClientRect().left,r=+window.getComputedStyle(this.wrapper).width.split("px")[0],n=(e.pageX-t)/r,o=this.options.onWrapperProgress;o&&o({progress:n})}}])&&p(t.prototype,r),n&&p(t,n),e}();function g(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){b(e,t,r[t])})}return e}function v(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function b(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}r.d(t,"AudioSurfer",function(){return _});var _=function(){function e(t,r){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),b(this,"progressTimer",null),b(this,"_defaultOptions",{color:"#1890ff",height:90,onCanplay:function(){},onPlaying:function(){},onPause:function(){},onEnded:function(){},onError:function(){}}),b(this,"_state",{isplaying:!1,canplay:!1,duration:0}),b(this,"_dealProgress",function(){var e=n._state.duration,t=n.getCurrentTime(),r="".concat((t/e*100).toFixed(4),"%");n.audioWrapper.dealProgress({percent:r})}),b(this,"_onCanplay",function(){var e=n.options.onCanplay;n._setState({canplay:!0}),n.getDuration(),e()}),b(this,"_onPlaying",function(){clearInterval(n.progressTimer),n.progressTimer=setInterval(n._dealProgress,500);var e=n.options.onPlaying;n._setState({isplaying:!0}),e()}),b(this,"_onPause",function(){clearInterval(n.progressTimer);var e=n.options.onPause;n._setState({isplaying:!1}),e()}),b(this,"_onEnded",function(){var e=n.options.onEnded;n._setState({isplaying:!1}),e()}),b(this,"_onError",function(e){var t=n.options.onError;n._setState({canplay:!1,isplaying:!1}),t(e)}),this.options=g({},this._defaultOptions,r);var o=this.options.height,i=document.createElement("div");i.style.cssText="position: relative; width: 100%; height: ".concat(o,"px;"),t.appendChild(i),this._init(i)}var t,r,n;return t=e,(r=[{key:"_init",value:function(e){var t=this;this.waveVisual=new h(e,g({},this.options)),this.audioWrapper=new y(e,g({},this.options,{onWrapperProgress:function(e){var r=e.progress;t._onWrapperProgress(r)}})),this.audioContainer=new Audio,this.audioContainer.addEventListener("canplay",this._onCanplay),this.audioContainer.addEventListener("playing",this._onPlaying),this.audioContainer.addEventListener("pause",this._onPause),this.audioContainer.addEventListener("ended",this._onEnded),this.audioContainer.addEventListener("error",this._onError)}},{key:"_setState",value:function(e){this._state=g({},this._state,e)}},{key:"_onWrapperProgress",value:function(e){var t=+(this._state.duration*e).toFixed(2);this.play2time(t)}},{key:"canPlay",value:function(){return this._state.canplay}},{key:"isPlaying",value:function(){return this._state.isplaying}},{key:"play",value:function(){this._setState({isplaying:!0}),this.audioContainer.play()}},{key:"play2time",value:function(e){var t=this.options.onError,r=this._state.duration;e<0||e>r?t(new Error("wrong time for play")):(this._setState({canplay:!1,isplaying:!1}),this.audioContainer.currentTime=e,this._dealProgress())}},{key:"pause",value:function(){this._setState({isplaying:!1}),this.audioContainer.pause()}},{key:"getCurrentTime",value:function(){return this.audioContainer.currentTime}},{key:"getDuration",value:function(){var e=this.audioContainer.duration;return this._setState({duration:e}),e}},{key:"load",value:function(e,t){this.audioContainer.src=e,this.audioContainer.load(e),this.waveVisual.load("http://localhost:1024/audio/222",g({method:"GET"},t))}},{key:"loadBuffer",value:function(e){var t=this;if(e&&!(!e instanceof ArrayBuffer)){var r=new Blob([e]),n=new FileReader;n.onload=function(){t.audioContainer.src=n.result,t.audioContainer.load(),t.waveVisual.load(e)},n.readAsDataURL(r)}}},{key:"destroy",value:function(){this.waveVisual.abort(),this.audioContainer.removeEventListener("canplay",this.onCanplay),this.audioContainer.removeEventListener("playing",this.onPlaying),this.audioContainer.removeEventListener("pause",this.onPause),this.audioContainer.removeEventListener("ended",this.onEnded),this.audioContainer.removeEventListener("error",this.onError),this.audioContainer=null}}])&&v(t.prototype,r),n&&v(t,n),e}()}])});